<!--包含头部文件-->
{include file="public/header" /}
<div id='wrapper'>
    <!--包含菜单文件-->
    {include file="public/menu" /}
    <section id='content'>
        <div class='container-fluid'>
            <div class='row-fluid' id='content-wrapper'>
                <div class='span12'>
                    <div class='page-header'>
                        <h1 class='pull-left'>
                            <i class='icon-cog'></i>
                            <span>权限管理</span>
                        </h1>
                        <div class='pull-right'>
                            <ul class='breadcrumb'>
                                <li>
                                    <a href="index.html"><i class='icon-bar-chart'></i>
                                    </a>
                                </li>
                                <li class='separator'>
                                    <i class='icon-angle-right'></i>
                                </li>
                                <li>
                                    角色权限
                                </li>
                                <li class='separator'>
                                    <i class='icon-angle-right'></i>
                                </li>
                                <li class='active'>权限管理</li>
                            </ul>
                        </div>
                    </div>
                    <div id="container" class="effect aside-float aside-bright mainnav-lg">

                        <!--NAVBAR-->
                        <!--===================================================-->

                        <!--===================================================-->
                        <!--END NAVBAR-->

                        <div class="panel">
                            <div class="panel-heading">
                                <h3 class="panel-title">
                                    <button class="btn btn-success" onclick="add()">添加权限</button>
                                </h3>
                            </div>
                            <div class="panel-body">
                                <table id="demo-dt-basic" class="table table-striped table-bordered" cellspacing="0"
                                       width="100%">
                                    <thead>
                                    <tr>
                                        <th>权限名</th>
                                        <th>权限</th>
                                        <th class="min-tablet">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {foreach name="data" id="v"}
                                    <tr>
                                        <td>{$v['_name']}</td>
                                        <td>{$v['path']}</td>
                                        <td>
                                            <a href="javascript:;" ruleId="{$v['ruleid']}" onclick="add_child(this)">添加子权限</a>
                                            |
                                            <a href="javascript:;" ruleId="{$v['ruleid']}" rightname="{$v['rightname']}"
                                               path="{$v['path']}" onclick="edit(this)">修改</a> |
                                            <a href="javascript:if(confirm('确定删除？'))location='{:url('admin/rule/deleterule',array('ruleid'=>$v['ruleid']))}'">删除</a>
                                        </td>
                                    </tr>
                                    {/foreach}
                                    </tbody>
                                </table>
                            </div>
                        </div>


                    </div>

                    <div class="modal fade" id="thinkright-add" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title" id="myModalLabel">
                                        添加权限
                                    </h4>
                                </div>
                                <div class="modal-body">
                                    <form class="form-horizontal" action="{:url('admin/rule/add')}" method="post">
                                        <div class="panel-body">
                                            <div class="form-group">
                                                <label class="col-sm-4 control-label"
                                                       for="demo-hor-inputemail">权限名</label>
                                                <div class="col-sm-9">
                                                    <input type="hidden" name="pid" value="0">
                                                    <input type="text" class="form-control"
                                                           name="rightname" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group" style="margin-top:15px;">
                                                <label class="col-sm-4 control-label"
                                                       for="demo-hor-inputpass">权限</label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control"
                                                           name="path" required="required">
                                                    <span class="text-warning">输入模块/控制器/方法即可 例如 admin/rule/index</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-footer text-right">
                                            <button class="btn btn-success" type="submit">提交</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 修改菜单模态框开始 -->
                    <div class="modal fade" id="thinkright-edit" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title" id="myModalLabel">
                                        修改权限
                                    </h4>
                                </div>
                                <div class="modal-body">
                                    <form class="form-horizontal" action="{:url('admin/rule/edit')}" method="post">
                                        <div class="panel-body">
                                            <div class="form-group">
                                                <label class="col-sm-4 control-label"
                                                       for="demo-hor-inputemail">权限名</label>
                                                <div class="col-sm-9">
                                                    <input type="hidden" name="ruleid">
                                                    <input type="text" id="demo-hor-inputemail" class="form-control"
                                                           name="rightname" required="required">
                                                </div>
                                            </div>
                                            <div class="form-group" style="margin-top:15px;">
                                                <label class="col-sm-4 control-label"
                                                       for="demo-hor-inputpass">权限</label>
                                                <div class="col-sm-9">
                                                    <input type="text" id="demo-hor-inputpass" class="form-control"
                                                           name="path" required="required">
                                                    <span class="text-danger">如admin/rule/index</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-footer text-right">
                                            <button class="btn btn-success" type="submit">修改</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<!--包含底部js-->
{include file="public/footer" /}
<script type="text/javascript" src="__STATIC__/admin/assets/javascripts/layer/2.4/layer.js"></script>

<script type="text/javascript">
    /*添加权限*/
    function add() {
        layer.open({
            type: 1,
            area: ['820px', '440px'], //宽高
            content: $('#thinkright-add').html()
        });

        $("input[name='title'],input[name='name']").val('');
        $("input[name='pid']").val(0);
//            $('#thinkright-add').modal('show');

    }


    // 添加子菜单
    function add_child(obj) {
        layer.open({
            type: 1,
            area: ['820px', '440px'], //宽高
            content: $('#thinkright-add').html()
        });

        var ruleId = $(obj).attr('ruleId');
        $("input[name='pid']").val(ruleId);
        $("input[name='rightname']").val('');
        $("input[name='path']").val('');

    }

    // 修改菜单
    function edit(obj) {
        layer.open({
            type: 1,
            area: ['820px', '440px'], //宽高
            content: $('#thinkright-edit').html()
        });

        var ruleId = $(obj).attr('ruleId');
        var rightname = $(obj).attr('rightname');
        var path = $(obj).attr('path');

        $("input[name='ruleid']").val(ruleId);
        $("input[name='rightname']").val(rightname);
        $("input[name='path']").val(path);
//            $('#thinkright-edit').modal('show');

    }
</script>